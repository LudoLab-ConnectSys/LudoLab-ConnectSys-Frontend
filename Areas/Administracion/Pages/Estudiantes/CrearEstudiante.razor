@page "/crear-estudiante"
@inject NavigationManager NavigationManager

<h3>Crear Nuevo Estudiante</h3>

<EditForm Model="@nuevoEstudiante" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="form-group">
                    <label for="apellido">Apellido:</label>
                    <InputText id="apellido" class="form-control" @bind-Value="nuevoEstudiante.Apellido" />
                </div>
                <div class="form-group">
                    <label for="nombre">Nombre:</label>
                    <InputText id="nombre" class="form-control" @bind-Value="nuevoEstudiante.Nombre" />
                </div>
                <div class="form-group">
                    <label for="fechaNacimiento">Fecha de Nacimiento:</label>
                    <InputDate id="fechaNacimiento" class="form-control" @bind-Value="nuevoEstudiante.FechaNacimiento" />
                </div>
                <div class="form-group">
                    <label for="ocupacion">Ocupación:</label>
                    <InputText id="ocupacion" class="form-control" @bind-Value="nuevoEstudiante.Ocupacion" />
                </div>
                <div class="form-group">
                    <label for="correo">Correo Electrónico:</label>
                    <InputText id="correo" class="form-control" @bind-Value="nuevoEstudiante.Correo" />
                </div>
                <div class="form-group">
                    <label for="telefono">Número de Teléfono:</label>
                    <InputText id="telefono" class="form-control" @bind-Value="nuevoEstudiante.Telefono" />
                </div>
                <div class="form-group">
                    <label for="ubicacion">Ubicación:</label>
                    <InputText id="ubicacion" class="form-control" @bind-Value="nuevoEstudiante.Ubicacion" />
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="form-group">
                    <label for="foto">Foto:</label>
                    <InputFile id="foto" class="form-control" OnChange="OnInputFileChange" />
                </div>
                @if (!string.IsNullOrEmpty(nuevoEstudiante.FotoUrl))
                {
                    <div class="form-group">
                        <img src="@nuevoEstudiante.FotoUrl" alt="Foto del estudiante" class="img-fluid rounded" style="max-width: 150px; height: auto;" />
                    </div>
                }
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-success">Guardar</button>
    <button type="button" class="btn btn-secondary" @onclick="Regresar">Cancelar</button>
</EditForm>

@code {
    private Estudiante nuevoEstudiante = new Estudiante();
    private IBrowserFile foto;

    private void HandleValidSubmit()
    {
        // Guardar el estudiante en la base de datos o servicio
        Console.WriteLine($"Estudiante creado: {nuevoEstudiante.Nombre}");
        NavigationManager.NavigateTo("/estudiantes");
    }

    private void Regresar()
    {
        NavigationManager.NavigateTo("/estudiantes");
    }

    private async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        foto = e.File;
        var buffer = new byte[foto.Size];
        await foto.OpenReadStream().ReadAsync(buffer);
        nuevoEstudiante.FotoUrl = $"data:image/jpeg;base64,{Convert.ToBase64String(buffer)}";
    }

    public class Estudiante
    {
        public int Id { get; set; }
        public string Apellido { get; set; }
        public string Nombre { get; set; }
        public DateTime FechaNacimiento { get; set; }
        public string Ocupacion { get; set; }
        public string Correo { get; set; }
        public string Telefono { get; set; }
        public string Ubicacion { get; set; }
        public string FotoUrl { get; set; }
    }
}
